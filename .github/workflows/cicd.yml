name: KBOT-CICD

on:
    push:
      branches:
        - develop

env:
    REGISTRY: ghcr.io
    IMAGE_NAME: ${{ github.repository }}

jobs:
    ci:
      
        name: CI
        runs-on: ubuntu-latest
        
        permissions:
            contents: read
            packages: write

        steps:

            - name: Checkout repository
              uses: 'actions/checkout@v4'
              with:
                fetch-depth: 0
      
            - name: Log in to the Container registry
              uses: docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1
              with:
                registry: ${{ env.REGISTRY }}
                username: ${{ github.actor }}
                password: ${{ secrets.GITHUB_TOKEN }}
            
            - name: Run test
              run: make test
            
            - name: Build&Push
              env:
                APP: "kbot"
                REGISTRY: "${{ env.REGISTRY }}/${{ github.actor }}"
              run: make image push


            